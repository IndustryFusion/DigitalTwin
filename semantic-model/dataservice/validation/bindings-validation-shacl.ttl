## shape file generated by SHACLGEN
@prefix ex: <http://www.example.org/> .
@prefix ns1: <https://industryfusion.github.io/contexts/ontology/v0/base/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix ngsi-ld: <https://uri.etsi.org/ngsi-ld/> .

ex:ns1_Binding a sh:NodeShape ;
    sh:nodeKind sh:BlankNodeOrIRI ;
    sh:property ex:ns1_bindingVersion,
        ex:ns1_bindsEntity,
        ex:ns1_bindsFirmware,
        ex:ns1_bindsLogic,
        ex:ns1_bindsAttributeType,
        ex:ns1_bindsMap ;
    sh:targetClass ns1:Binding .

ex:ns1_BoundMap a sh:NodeShape ;
    sh:nodeKind sh:BlankNodeOrIRI ;
    sh:property ex:ns1_bindsConnector,
        ex:ns1_bindsConnectorAttribute,
        ex:ns1_bindsLogicVar,
        ex:ns1_bindsMapDatatype ;
    sh:targetClass ns1:BoundMap .



ex:ns1_bindingVersion a sh:PropertyShape ;
    sh:nodeKind sh:Literal ;
    sh:path ns1:bindingVersion ;
    sh:maxCount 1 ;
    sh:minCount 1 .


ex:ns1_bindsConnector a sh:PropertyShape ;
    sh:nodeKind sh:IRI ;
    sh:path ns1:bindsConnector ;
    sh:maxCount 1 ;
    sh:minCount 1 .

ex:ns1_bindsConnectorAttribute a sh:PropertyShape ;
    sh:nodeKind sh:Literal ;
    sh:path ns1:bindsConnectorAttribute ;
    sh:maxCount 1 ;
    sh:minCount 1 .

ex:ns1_bindsEntity a sh:PropertyShape ;
    sh:nodeKind sh:IRI ;
    sh:path ns1:bindsEntity ;
    sh:maxCount 1 ;
    sh:minCount 1 .

ex:ns1_bindsFirmware a sh:PropertyShape ;
    sh:nodeKind sh:Literal ;
    sh:path ns1:bindsFirmware ;
    sh:maxCount 1 ;
    sh:minCount 1 .

ex:ns1_bindsLogic a sh:PropertyShape ;
    sh:nodeKind sh:Literal ;
    sh:path ns1:bindsLogic ;
    sh:maxCount 1 ;
    sh:minCount 0 .

ex:ns1_bindsLogicVar a sh:PropertyShape ;
    sh:nodeKind sh:Literal ;
    sh:path ns1:bindsLogicVar ;
    sh:minCount 1 .

ex:ns1_bindsMap a sh:PropertyShape ;
    sh:nodeKind sh:IRI ;
    sh:path ns1:bindsMap ;
    sh:maxCount 1 ;
    sh:minCount 1 .

ex:ns1_bindsMapDatatype a sh:PropertyShape ;
    sh:nodeKind sh:IRI ;
    sh:path ns1:bindsMapDatatype ;
    sh:minCount 1 ;
    sh:maxCount 1 .

ex:ns1_bindsAttributeType a sh:PropertyShape ;
    sh:nodeKind sh:IRI ;
    sh:path ns1:bindsAttributeType ;
    sh:in (ngsi-ld:Property ngsi-ld:Relationship);
    sh:minCount 1 ;
    sh:maxCount 1 .

ex:ns1_allbound a sh:NodeShape ;
    sh:targetClass ns1:Binding ;
    sh:property [
        sh:path [ sh:inversePath ns1:boundBy ] ;
        sh:message "This instance of Binding has no effect. It is not bound to a property." ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
    ]
.


ex:BindingShape
    a sh:NodeShape ;
    sh:targetClass ns1:Binding ;
    sh:sparql [
        a sh:SPARQLConstraint ;
        sh:message "The term defined in bindsLogic of Binding <{$this}> must use {?var} defined in Map <{?map}>." ;
        sh:select """
            PREFIX ns1: <https://industryfusion.github.io/contexts/ontology/v0/base/>
            SELECT $this ?var ?map
            WHERE {
                $this ns1:bindsLogic ?logic .
  				#$this a ns1:Binding .
                $this ns1:bindsMap ?map .
                ?map a ns1:BoundMap ;
                     ns1:bindsLogicVar ?var .
                FILTER(!CONTAINS(?logic, CONCAT('?', ?var, ' ')))
            }
        """ ;
    ] .



